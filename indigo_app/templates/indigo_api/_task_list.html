{% load humanize indigo_app %}

{% if tasks %}
<table class="table table-striped table-sm">
  <thead>
  <tr>
    <th scope="col" colspan="2">Task</th>
    {% if place %}
      <th scope="col">Place</th>
    {% endif %}
    <th scope="col">Work/Document</th>
  </tr>
  </thead>
  <tbody>
  {% for task in tasks %}
  <tr>
    <!-- Task Number -->
    <td>
      <div class="text-muted mr-2">
        <i class="fas fa-fw task-icon-{{ task.state }} text-{{ task.state }} small mr-2"></i>
        {% if perms.indigo_api.change_task and task.is_open and selectable%}
        <label class="mb-0 font-weight-normal c-pointer">
          <input type="checkbox" name="tasks" value="{{ task.id }}" form="bulk-task-update-form" class="mr-1">
          #{{ task.id }}
        </label>
        {% else %}
        #{{ task.id }}
        {% endif %}
      </div>
    </td>
    <!-- Task title -->
    <td>
      <div class="d-flex align-items-center">
        <a href="{% url 'task_detail' place=task.place.place_code pk=task.pk %}" class="{% if task.labels.all %} d-flex mr-1 {% endif %}">{{ task.title }}</a>
        {% for label in task.labels.all %}
        <span class="badge badge-secondary mr-1" title="{{ label.description }}">{{ label.title }}</span>
        {% endfor %}
      </div>
    </td>

    {% if place %}
      <td>
        {{ task.place }}
      </td>
    {% endif %}
    <td>
      {% if task.document %}
      <div>
        <a href="{% url 'document' doc_id=task.document.id %}" class="text-muted">{{ task.document.title }} @ {{ task.document.expression_date|date:'Y-m-d' }} Â· {{ task.document.language }}</a>
      </div>
      {% elif task.work %}
      <div>
        <a href="{% url 'work' frbr_uri=task.work.frbr_uri %}" class="text-muted" data-popup-url="{% url 'work_popup' frbr_uri=task.work.frbr_uri %}">{{ task.work.title }}</a>
      </div>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<div class="card-body">
  <p class="alert alert-info">No tasks found</p>
</div>
{% endif %}